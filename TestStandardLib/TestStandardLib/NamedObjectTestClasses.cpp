#include "StandardLib/ObjectWriter.h"
#include "StandardLib/ObjectReader.h"
#include "StandardLib/ClassDefines.h"
#include "NamedObjectTestClasses.h"


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestNamedObject> CTestNamedObject::Init(int iNum)
{
	PreInit();
	miNum = iNum;

	PostInit();
	return this;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestNamedObject::Class(void)
{
	M_Pointer(mpNamedTest1);
	M_Pointer(mpNamedTest2);
	U_Int32(miNum);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestNamedObject::Free(void)
{
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CTestNamedObject::Save(CObjectWriter* pcFile)
{
	ReturnOnFalse(pcFile->WriteInt32(miNum));
	return true;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CTestNamedObject::Load(CObjectReader* pcFile)
{
	ReturnOnFalse(pcFile->ReadInt32(&miNum));
	return true;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestNamedObjectSmall> CTestNamedObjectSmall::Init(char* sz)
{
	return Init((const char*)sz);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestNamedObjectSmall> CTestNamedObjectSmall::Init(const char* sz)
{
	PreInit();

	memset(mac, 0, 4);
	StrCpySafe(mac, sz, 4);

	PostInit();
	return this;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestNamedObjectSmall::Class(void)
{
	U_CharArray(mac, 4);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestNamedObjectSmall::Free(void)
{
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CTestNamedObjectSmall::Save(CObjectWriter* pcFile)
{
	ReturnOnFalse(pcFile->WriteData(mac, 4));
	return true;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CTestNamedObjectSmall::Load(CObjectReader* pcFile)
{
	ReturnOnFalse(pcFile->ReadData(mac, 4));
	return true;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestNamedObjectWithEmbedded> CTestNamedObjectWithEmbedded::Init(int iX, int iY, int iName1, int iName2, CPointer pObject, Ptr<CTestNamedObjectSmall> pSmall)
{
	PreInit();

	miX = iX;
	miY = iY;
	mNamedTest1.Init(iName1);
	mNamedTest2.Init(iName2);
	mpObject = pObject;
	mpSmall = pSmall;
	mpvUnmanaged = NULL;
	miUnmagedSize = 0;

	PostInit();
	return this;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestNamedObjectWithEmbedded::Class(void)
{
	M_Pointer(mpObject);
	M_Pointer(mpSmall);
	M_Embedded(mNamedTest1);
	M_Embedded(mNamedTest2);
	U_Int32(miX);
	U_Int32(miY);
	U_UInt16(miUnmagedSize);
	U_Pointer(mpvUnmanaged);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestNamedObjectWithEmbedded::Free(void)
{
	SafeFree(mpvUnmanaged);
	miUnmagedSize = 0;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CTestNamedObjectWithEmbedded::Save(CObjectWriter* pcFile)
{
	ReturnOnFalse(pcFile->WriteInt32(miX));
	ReturnOnFalse(pcFile->WriteInt32(miY));
	return true;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CTestNamedObjectWithEmbedded::Load(CObjectReader* pcFile)
{
	mpvUnmanaged = NULL;
	miUnmagedSize = 0;

	ReturnOnFalse(pcFile->ReadInt32(&miX));
	ReturnOnFalse(pcFile->ReadInt32(&miY));
	return true;
}

