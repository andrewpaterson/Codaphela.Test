#include "StandardLib/ObjectSerialiser.h"
#include "StandardLib/ObjectDeserialiser.h"
#include "ObjectTestClasses.h"


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestObject> CTestObject::Init(void)
{
	return Init(NULL);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestObject> CTestObject::Init(CPointer pObject, Ptr<CTestObject> pTest)
{
	mpObject = pObject;
	mpTest = pTest;
	return Init(NULL);
}



//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestObject> CTestObject::Init(STestObjectFreedNotifier* psKilledNotifier)
{
	PreInit();
	mpsKilledNotifier = psKilledNotifier;
	if (mpsKilledNotifier)
	{
		mpsKilledNotifier->bFreed= FALSE;
	}

	PostInit();
	return this;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestObject::Class(void)
{
	CObject::Class();
	Pointer(mpObject.This());
	Pointer(mpTest.This());
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestObject::Free(void)
{
	if (mpsKilledNotifier)
	{
		mpsKilledNotifier->bFreed = TRUE;
	}
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CTestObject::Save(CObjectSerialiser* pcFile)
{
	return FALSE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CTestObject::Load(CObjectDeserialiser* pcFile)
{
	return FALSE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestObject::SomeMethod(void)
{
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestTriPointerObject> CTestTriPointerObject::Init(void)
{
	return Init(NULL);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestTriPointerObject> CTestTriPointerObject::Init(STestObjectFreedNotifier* psKilledNotifier)
{
	PreInit();
	mpsKilledNotifier = psKilledNotifier;
	if (mpsKilledNotifier)
	{
		mpsKilledNotifier->bFreed = FALSE;
	}

	PostInit();
	return this;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestTriPointerObject::Class(void)
{
	CObject::Class();
	Pointer(mpObject1.This());
	Pointer(mpObject2.This());
	Pointer(mpObject3.This());
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestTriPointerObject::Free(void)
{
	if (mpsKilledNotifier)
	{
		mpsKilledNotifier->bFreed = TRUE;
	}
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CTestTriPointerObject::Save(CObjectSerialiser* pcFile)
{
	return FALSE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CTestTriPointerObject::Load(CObjectDeserialiser* pcFile)
{
	return FALSE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestSaveableObject1> CTestSaveableObject1::Init(void)
{
	PreInit();
	miInt = 7;
	mszString.Init();
	mbSaved = FALSE;

	PostInit();
	return Ptr<CTestSaveableObject1>(this);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestSaveableObject1::Class(void)
{
	CObject::Class();
	Pointer(mpObject.This());
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestSaveableObject1::Free(void)
{
	mszString.Kill();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CTestSaveableObject1::Save(CObjectSerialiser* pcFile)
{
	ReturnOnFalse(pcFile->WritePointer(mpObject));
	ReturnOnFalse(pcFile->WriteInt(miInt));
	ReturnOnFalse(mszString.WriteString(pcFile));

	mbSaved = TRUE;
	return TRUE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CTestSaveableObject1::Load(CObjectDeserialiser* pcFile)
{
	ReturnOnFalse(pcFile->ReadPointer(mpObject.This()));
	ReturnOnFalse(pcFile->ReadInt(&miInt));
	ReturnOnFalse(mszString.ReadString(pcFile));

	mbSaved = FALSE;
	return TRUE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
Ptr<CTestSaveableObject2> CTestSaveableObject2::Init(char* psz)
{
	PreInit();
	msz.Init(psz);
	mbSaved = FALSE;

	PostInit();
	return Ptr<CTestSaveableObject2>(this);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestSaveableObject2::Class(void)
{
	CObject::Class();
	Pointer(mp1.This());
	Pointer(mp2.This());
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CTestSaveableObject2::Free(void)
{
	msz.Kill();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CTestSaveableObject2::Save(CObjectSerialiser* pcFile)
{
	pcFile->WritePointer(mp1);
	pcFile->WritePointer(mp2);
	msz.WriteString(pcFile);
	mbSaved = TRUE;
	return TRUE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CTestSaveableObject2::Load(CObjectDeserialiser* pcFile)
{
	pcFile->ReadPointer(mp1.This());
	pcFile->ReadPointer(mp2.This());
	msz.ReadString(pcFile);
	mbSaved = FALSE;
	return TRUE;
}

